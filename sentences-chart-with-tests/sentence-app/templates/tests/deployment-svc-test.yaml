apiVersion: v1
kind: Pod
metadata:
  name: "{{ .Release.Name }}-svc-test"
  annotations:
    # this annotations is what makes this pod spec a helm test!
    "helm.sh/hook": test
    # we can use this hook to automatically delete the pod
    # after the test has succussfully run, but keep the pod if it fails
    # such that we can inspect why the test failed
    "helm.sh/hook-delete-policy": hook-succeeded
spec:
  restartPolicy: Never
  containers:
    - name: "{{ .Release.Name }}-svc-test"
      image: praqma/network-multitool:minimal
      command: ["curl", "-s", "sentence:8080"]
